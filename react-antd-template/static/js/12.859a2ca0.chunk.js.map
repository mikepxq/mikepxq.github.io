{"version":3,"sources":["console-layout/content-main.tsx","views/article-manage/components/article-collapse-form.tsx","views/article-manage/create.tsx"],"names":["ContentMain","props","className","children","Panel","Collapse","ArticleCollapseForm","onPublish","onDraft","form","draftLoading","publishLoading","collapseIsOpen","onChangeCollapse","activeKey","String","showArrow","header","type","onClick","style","transform","loading","labelCol","span","wrapperCol","gutter","Item","name","label","rules","required","placeholder","TextArea","maxLength","resetFields","ArticleManage","EditorRef","React","createRef","useState","draft","publish","loadingMap","setLoadingMap","id","setId","onCreate","options","a","validateFields","catch","_form","setCollapseIsOpen","publishStatus","current","editor","getInstance","reqArticleCreate","markdown","getMarkdown","res","code","appNotification","error","message","success","data","onUpdate","undefined","reqArticleUpdate","Form","useForm","marginTop","initialValue","articleInitialValue","previewStyle","initialEditType","ref","height"],"mappings":"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","file":"static/js/12.859a2ca0.chunk.js","sourcesContent":["import React from \"react\";\r\ninterface Props {\r\n  [key: string]: any;\r\n}\r\n/**主内容区 可以统一ui 并减少一层dom */\r\nconst ContentMain: React.FC<ViewProps<Props>> = (props) => {\r\n  const { className = \"\" } = props;\r\n  //render\r\n  return <main className={`content-main ${className}`}>{props.children}</main>;\r\n};\r\nexport default ContentMain;\r\n","import React from \"react\";\r\nimport { Button, Col, Collapse, Form, Input, Row, Space } from \"antd\";\r\nimport { RightOutlined } from \"@ant-design/icons\";\r\nimport AppInput from \"@/components/app-input\";\r\nconst { Panel } = Collapse;\r\ninterface Props {\r\n  form: Antd.FormInstance;\r\n  onPublish?: () => void;\r\n  onDraft?: () => void;\r\n  draftLoading?: boolean;\r\n  publishLoading?: boolean;\r\n  collapseIsOpen?: boolean;\r\n  onChangeCollapse?: (value: boolean) => void;\r\n}\r\nconst ArticleCollapseForm: React.FC<ViewProps<Props>> = (props) => {\r\n  const {\r\n    className = \"\",\r\n    onPublish,\r\n    onDraft,\r\n    form,\r\n    draftLoading,\r\n    publishLoading,\r\n    collapseIsOpen = true,\r\n    onChangeCollapse,\r\n  } = props;\r\n\r\n  //render\r\n  return (\r\n    <Collapse className={`article-collapse-form ${className}`} activeKey={[String(collapseIsOpen)]}>\r\n      <Panel\r\n        showArrow={false}\r\n        header={\r\n          <nav className=\"clear\">\r\n            <Button\r\n              type=\"primary\"\r\n              onClick={() => {\r\n                onChangeCollapse && onChangeCollapse(!collapseIsOpen);\r\n              }}>\r\n              配置\r\n              <RightOutlined className=\"arrow\" style={{ transform: `rotate(${collapseIsOpen ? 90 : 0}deg)` }} />\r\n            </Button>\r\n            <Space className=\"fr\">\r\n              <Button onClick={onPublish} type=\"primary\" loading={publishLoading}>\r\n                发布\r\n              </Button>\r\n              <Button onClick={onDraft} loading={draftLoading}>\r\n                草稿\r\n              </Button>\r\n            </Space>\r\n          </nav>\r\n        }\r\n        key=\"true\">\r\n        <Form form={form} labelCol={{ span: 5 }} wrapperCol={{ span: 19 }}>\r\n          <Row gutter={24}>\r\n            <Col span={8}>\r\n              <Form.Item name=\"title\" label=\"标题\" rules={[{ required: true }]}>\r\n                <AppInput placeholder=\"请输入标题\" />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={8}>\r\n              <Form.Item name=\"author\" label=\"作者\" rules={[{ required: true }]}>\r\n                <AppInput placeholder=\"请输入作者\" />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={8}>\r\n              <Form.Item name=\"description\" label=\"描述\">\r\n                <Input.TextArea placeholder=\"请输入描述\" maxLength={100}></Input.TextArea>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n          {/* <Row gutter={24}>\r\n            <Col span={8}></Col>\r\n          </Row> */}\r\n        </Form>\r\n        <footer className=\"clear\">\r\n          <Button\r\n            className=\"fr\"\r\n            onClick={() => {\r\n              form.resetFields();\r\n            }}>\r\n            重置\r\n          </Button>\r\n        </footer>\r\n      </Panel>\r\n    </Collapse>\r\n  );\r\n};\r\nexport default ArticleCollapseForm;\r\n","import { Form } from \"antd\";\r\nimport React, { useState } from \"react\";\r\nimport \"@toast-ui/editor/dist/toastui-editor.css\";\r\nimport { Editor } from \"@toast-ui/react-editor\";\r\nimport ContentMain from \"@/console-layout/content-main\";\r\nimport ArticleCollapseForm from \"./components/article-collapse-form\";\r\n\r\nimport { reqArticleCreate, reqArticleUpdate } from \"@/apis\";\r\nimport { appNotification } from \"@/plugins/antd\";\r\nimport { articleInitialValue } from \"@/model/article\";\r\ninterface Props {\r\n  [key: string]: any;\r\n}\r\ntype OnSubmitOptions = { publishStatus: ArticleStatus };\r\nconst ArticleManage: React.FC<ViewProps<Props>> = (props) => {\r\n  const { className = \"\" } = props;\r\n  const EditorRef = React.createRef<Editor>();\r\n  const [loadingMap, setLoadingMap] = useState({ draft: false, publish: false });\r\n  //文章id\r\n  const [id, setId] = useState<number>();\r\n\r\n  /** 新建文章 */\r\n  const onCreate = async (options: OnSubmitOptions) => {\r\n    const _form = await form.validateFields().catch(() => undefined);\r\n    if (!_form) return setCollapseIsOpen(true);\r\n    if (loadingMap[options.publishStatus] || !EditorRef.current) return;\r\n    const editor = EditorRef.current.getInstance();\r\n    setLoadingMap({ ...loadingMap, [options.publishStatus]: true });\r\n    const res = await reqArticleCreate({ ...options, ..._form, markdown: editor.getMarkdown() });\r\n    setLoadingMap({ ...loadingMap, [options.publishStatus]: false });\r\n    if (res.code != 200) return appNotification.error({ message: res.message || \"添加失败！\" });\r\n    appNotification.success({ message: res.message || \"添加成功！\" });\r\n    setId(res.data.id);\r\n  };\r\n  /** 再次保存文章 带上id */\r\n  const onUpdate = async (options: OnSubmitOptions) => {\r\n    const _form = await form.validateFields().catch(() => undefined);\r\n    if (!_form) return setCollapseIsOpen(true);\r\n    if (loadingMap[options.publishStatus] || !EditorRef.current || id === undefined) return;\r\n    const editor = EditorRef.current.getInstance();\r\n    setLoadingMap({ ...loadingMap, [options.publishStatus]: true });\r\n    const res = await reqArticleUpdate({ id, ...options, ..._form, markdown: editor.getMarkdown() });\r\n    setLoadingMap({ ...loadingMap, [options.publishStatus]: false });\r\n    if (res.code != 200) return appNotification.error({ message: res.message || \"更新失败！\" });\r\n    appNotification.success({ message: res.message || \"更新成功！\" });\r\n  };\r\n\r\n  const [form] = Form.useForm<FormDataArticle>();\r\n  const [collapseIsOpen, setCollapseIsOpen] = useState(true); //默认显示表单\r\n\r\n  //render\r\n  return (\r\n    <ContentMain className={`${className} flex-column`}>\r\n      <ArticleCollapseForm\r\n        collapseIsOpen={collapseIsOpen}\r\n        onChangeCollapse={setCollapseIsOpen}\r\n        form={form}\r\n        onDraft={() => {\r\n          if (id === undefined) return onCreate({ publishStatus: \"draft\" });\r\n          onUpdate({ publishStatus: \"draft\" });\r\n        }}\r\n        draftLoading={loadingMap.draft}\r\n        publishLoading={loadingMap.publish}\r\n        onPublish={() => {\r\n          if (id === undefined) return onCreate({ publishStatus: \"publish\" });\r\n          onUpdate({ publishStatus: \"publish\" });\r\n        }}\r\n      />\r\n      <main className=\"all-remain\" style={{ marginTop: 10 }}>\r\n        <Editor\r\n          initialValue={articleInitialValue}\r\n          previewStyle=\"vertical\"\r\n          initialEditType=\"markdown\"\r\n          ref={EditorRef}\r\n          height=\"100%\"\r\n        />\r\n      </main>\r\n    </ContentMain>\r\n  );\r\n};\r\nexport default ArticleManage;\r\n"],"sourceRoot":""}